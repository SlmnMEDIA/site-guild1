<!doctype = html>
<html lang="en">
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="stylesheet.css">
<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico">
<script>
  function init() {
    var ajax = new XMLHttpRequest();
    ajax.open("POST", "/chats", true);
    ajax.setRequestHeader("content-type", "application/x-www-form-urlencoded");
    ajax.onreadystatechange = function() {
    if (ajax.readyState == 4 && ajax.status == 200) {
      console.log("responseText: " + ajax.responseText);
      var msgs = JSON.parse(ajax.responseText).reverse();
      console.log(msgs[0]);
      var chats = document.getElementById("chat");
      var texts = msgs.map(function(msg) {
        return "| " + msg.username + ": " + msg.shout;
      });
      console.log(texts);
      chat.innerHTML = texts.join('<br/>');
    }
    }
    ajax.send();
  }
  function sendShout() {
    var msg = document.chat.msg.value;
    var data = "username=" + username + "&msg=" + encodeURIComponent(msg);
    var ajax = new XMLHttpRequest();
    ajax.open("POST", "/chat", true);
    ajax.setRequestHeader("content-type", "application/x-www-form-urlencoded");
    ajax.onreadystatechange = function() {
      if (ajax.readyState == 4 && ajax.status == 200) {
        console.log("responseText: " + ajax.responseText);
        var msgs = JSON.parse(ajax.responseText).reverse();
        console.log(msgs[0]);
        var chat = document.getElementById("chat");
        var texts = msgs.map(function(msg) {
          return msg.username + ": " + msg.shout;
        });
        console.log(texts);
        chat.innerHTML = texts.join('<br/>');
        }
      }
    ajax.send(data);
  }
</script>
</head>
<body onload = "init();">
  <div id="chat"></div>
  <div id="input">
     <form id="say" name="say">
       <textarea id="msg" name="msg" COLS=20 rows=3.5 onkeydown="if (event.keyCode == 13) document.getElementById('say').click()"></textarea>
       <button type="button" id="say" onclick="sendSay()">Say</button>
     </form>
  </div>
</body>
</html>
